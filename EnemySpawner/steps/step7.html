<div class="step-content">
    <h2>Step 7: Create spawn_enemy_wave() Function</h2>

    <p>Right now, your game spawns one enemy at a time when all enemies are destroyed. This works, but it doesn't create much challenge. What if you could spawn multiple enemies at once—and increase the number each time?</p>

    <div class="info-box">
        <h3>Wave Mechanics</h3>
        <p><strong>Wave systems</strong> spawn progressively larger groups of enemies to create escalating difficulty.</p>
        <p><strong>The goal:</strong> Each wave should have MORE enemies than the last wave.</p>
        <p><strong>How do we know how many to spawn?</strong> Count how many enemies are in the table, then spawn that many PLUS one more!</p>
        <ul>
            <li><strong>Wave 1:</strong> 1 enemy → spawn 2 next time</li>
            <li><strong>Wave 2:</strong> 2 enemies → spawn 3 next time</li>
            <li><strong>Wave 3:</strong> 3 enemies → spawn 4 next time</li>
            <li><strong>Wave N:</strong> N enemies → spawn N+1 next time</li>
        </ul>
        <p><strong>Result:</strong> Linear difficulty increase that feels fair and challenging.</p>
    </div>

    <h3>Your Task</h3>

    <p>Create a <code>spawn_enemy_wave()</code> function that spawns multiple enemies at once, with each wave spawning one more enemy than the previous wave.</p>

    <p><strong>Requirements:</strong></p>
    <ol>
        <li>Use a traditional for loop: <code>for i = 1, #enemies do</code>
            <ul>
                <li><code>#enemies</code> gives the current size of the enemies table</li>
                <li>Loop from 1 to that number</li>
            </ul>
        </li>
        <li>Inside the loop: Call <code>spawn_enemy()</code> once per iteration</li>
        <li>After the loop: Call <code>spawn_enemy()</code> ONE more time</li>
        <li>Result: Total spawned = <code>#enemies + 1</code></li>
    </ol>

    <h3>The Implementation</h3>

    <p>Here's the <code>spawn_enemy_wave()</code> function:</p>

    <div id="spawn-enemy-wave-code"></div>

    <script>
        const spawnWaveCode = `function spawn_enemy_wave()
  -- Spawn one enemy for each enemy currently in the table
  for i = 1, #enemies do
    spawn_enemy()
  end

  -- Spawn ONE more enemy to increase difficulty
  spawn_enemy()
end`;

        renderCodeBlock('spawn-enemy-wave-code', spawnWaveCode, 'lua');
    </script>

    <p><strong>Note:</strong> <code>for i = 1, #enemies do</code> is a traditional counting loop. The <code>#</code> operator returns table length. Use this when you know how many iterations; use <code>pairs()</code> to iterate over table contents.</p>

    <p><strong>Key insight:</strong> The loop spawns N enemies, then one more—so the table grows by 1 each wave, creating linear difficulty increase.</p>

    <h3>Testing</h3>

    <p>Test with <code>spawn_enemy_wave()</code>—each call should spawn progressively more enemies based on current table size.</p>

    <div id="test-commands"></div>

    <script>
        const testCommands = `print(#enemies)  // 1
spawn_enemy_wave()
print(#enemies)  // 2 (spawned 1+1)

spawn_enemy_wave()
print(#enemies)  // 4 (spawned 2+1, 1 reused)`;

        renderCodeBlock('test-commands', testCommands, 'lua');
    </script>

    <div class="success-box">
        <h3>Wave-Based Difficulty</h3>
        <p>You've implemented escalating difficulty used in Call of Duty Zombies, Vampire Survivors, and Geometry Wars. Your linear formula (<code>n + 1</code>) creates fair, predictable progression. Try other formulas: <code>n * 1.5</code> (steeper), <code>n ^ 2</code> (exponential), or <code>min(n + 1, 10)</code> (capped).</p>
    </div>
</div>

<style>
/* Disable copying for code blocks - students should type the code themselves */
.step-content .code-block-wrapper .copy-btn {
    display: none;
}

.step-content .code-block-wrapper .line-content {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.step-content .code-block-wrapper pre {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}
</style>
