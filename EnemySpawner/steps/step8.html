<div class="step-content">
    <h2>Step 8: Implement Wave System</h2>

    <p>You've created the building blocks—now it's time to put them together. You have a function that spawns one enemy (<code>spawn_enemy()</code>) and a function that spawns multiple enemies (<code>spawn_enemy_wave()</code>). Currently, your game spawns one enemy at a time. With a single line change, you'll transform it into a wave-based system.</p>

    <div class="info-box">
        <h3>The Power of Small Changes</h3>
        <p>Sometimes the smallest code changes create the biggest impact on gameplay.</p>
        <p><strong>Current behavior:</strong> When all enemies destroyed → spawn 1 enemy</p>
        <p><strong>New behavior:</strong> When all enemies destroyed → spawn an entire wave (progressively more enemies)</p>
        <p><strong>The change:</strong> Replace <code>spawn_enemy()</code> with <code>spawn_enemy_wave()</code> in <code>update_enemies()</code></p>
        <p><strong>Result:</strong> Escalating difficulty, engaging gameplay loop, professional wave mechanics</p>
    </div>

    <h3>Your Task</h3>

    <p>Update your <code>update_enemies()</code> function to use wave spawning instead of single-enemy spawning.</p>

    <p><strong>Requirements:</strong></p>
    <ol>
        <li>Find the line in <code>update_enemies()</code> that calls <code>spawn_enemy()</code></li>
        <li>Replace it with <code>spawn_enemy_wave()</code></li>
        <li>That's it! One line change transforms your entire game</li>
    </ol>

    <h3>The Changes</h3>

    <p>Here's the simple but powerful update to <code>update_enemies()</code>:</p>

    <div id="update-enemies-diff"></div>

    <script>
        const oldUpdate = `function update_enemies()
  for ix, enemy in pairs(enemies) do
    if not enemy.isDestroyed then
      enemy.x = enemy.x + enemy.vx
      enemy.y = enemy.y + enemy.vy

      enemy.rotation = enemy.rotation + enemy.rotation_speed

      if enemy.x < -100 then enemy.vx = -enemy.vx end
      if enemy.x > 100 then enemy.vx = -enemy.vx end
      if enemy.y < -100 then enemy.vy = -enemy.vy end
      if enemy.y > 100 then enemy.vy = -enemy.vy end
    end
  end

  -- Check if all enemies are destroyed
  if all_enemies_destroyed() then
    spawn_enemy()  -- Spawn one new enemy
  end
end`;

        const newUpdate = `function update_enemies()
  for ix, enemy in pairs(enemies) do
    if not enemy.isDestroyed then
      enemy.x = enemy.x + enemy.vx
      enemy.y = enemy.y + enemy.vy

      enemy.rotation = enemy.rotation + enemy.rotation_speed

      if enemy.x < -100 then enemy.vx = -enemy.vx end
      if enemy.x > 100 then enemy.vx = -enemy.vx end
      if enemy.y < -100 then enemy.vy = -enemy.vy end
      if enemy.y > 100 then enemy.vy = -enemy.vy end
    end
  end

  -- Check if all enemies are destroyed
  if all_enemies_destroyed() then
    spawn_enemy_wave()  -- Spawn a whole wave!
  end
end`;

        renderDiffBlock('update-enemies-diff', oldUpdate, newUpdate, 'Replace spawn_enemy() with spawn_enemy_wave()');
    </script>

    <p><strong>What just happened?</strong> This one-line change creates a complete wave system. Game starts with 1 enemy → 2 spawn → 3 spawn → pattern continues. Composable functions enable massive gameplay impact from tiny changes.</p>

    <h3>Testing</h3>

    <p>Play the game—each wave should spawn progressively more enemies. 1 enemy → 2 enemies → 3 enemies. Difficulty increases linearly with no end.</p>

    <h3>Try It Yourself</h3>

    <p>Play the complete wave system below. Destroy each wave and watch the difficulty increase:</p>

    <div id="step8-demo" style="margin: 10px 0;"></div>

    <script>
        createLazyEmbed('step8-demo', 'https://microstudio.io/jocolloman/spawningenemies8/UPNXXGRY/', 400);
    </script>

    <div class="success-box">
        <h3>Complete Wave System</h3>
        <p>You've implemented dynamic spawning, object pooling, state checking, event-driven gameplay, and wave mechanics—techniques used in survival games, tower defense, bullet hell, roguelikes, and arena shooters.</p>
    </div>
</div>

<style>
/* Disable copying for diff block - students should type the code themselves */
.step-content .diff-block-wrapper .copy-btn {
    display: none;
}

.step-content .diff-block-wrapper .line-content {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.step-content .diff-block-wrapper .diff-lines {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}
</style>
