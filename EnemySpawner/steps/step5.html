<div class="step-content">
    <h2>Step 5: Create all_enemies_destroyed() Function</h2>

    <p>Now that you have a working <code>spawn_enemy()</code> function with object pooling, you need a way to detect when the player has destroyed all enemies. This is the foundation of the wave system you'll build later.</p>

    <div class="info-box">
        <h3>State Checking Functions</h3>
        <p><strong>State checking functions</strong> answer yes/no questions about your game state. They return <code>true</code> or <code>false</code> (boolean values).</p>
        <p><strong>Common examples in games:</strong></p>
        <ul>
            <li><code>is_player_dead()</code> - Check if player health is 0</li>
            <li><code>is_level_complete()</code> - Check if all objectives are met</li>
            <li><code>has_collected_all_coins()</code> - Check if coin count matches total</li>
            <li><code>all_enemies_destroyed()</code> - Check if no enemies are alive</li>
        </ul>
        <p><strong>Why they're useful:</strong> These functions let you trigger events, show messages, spawn new waves, or transition to different game states.</p>
    </div>

    <h3>Your Task</h3>

    <p>Create an <code>all_enemies_destroyed()</code> function that checks if all enemies in the <code>enemies</code> table have been destroyed.</p>

    <p><strong>Requirements:</strong></p>
    <ol>
        <li>Loop through the <code>enemies</code> table using <code>for ix, enemy in pairs(enemies)</code></li>
        <li>Check if any enemy has <code>isDestroyed == false</code> (meaning it's still alive)</li>
        <li>If you find a living enemy, immediately <code>return false</code> (not all destroyed)</li>
        <li>If the loop completes without finding any living enemies, <code>return true</code> (all destroyed)</li>
    </ol>

    <h3>The Implementation</h3>

    <p>Here's the <code>all_enemies_destroyed()</code> function:</p>

    <div id="all-enemies-destroyed-code"></div>

    <script>
        const allEnemiesDestroyedCode = `function all_enemies_destroyed()
  for ix, enemy in pairs(enemies) do
    if not enemy.isDestroyed then
      return false  -- Found a living enemy - not all destroyed!
    end
  end
  return true  -- Made it through the loop - all destroyed!
end`;

        renderCodeBlock('all-enemies-destroyed-code', allEnemiesDestroyedCode, 'lua');
    </script>

    <p><strong>Early return pattern:</strong> The function stops as soon as it finds one living enemy. If the loop completes without finding any, all are destroyed.</p>

    <h3>Testing</h3>

    <p>Test with: <code>print(all_enemies_destroyed())</code> — returns <code>false</code> with enemies alive, <code>true</code> when all destroyed.</p>

    <div id="test-commands"></div>

    <script>
        const testCommands = `// With enemies on screen
print(all_enemies_destroyed())  // false

// After destroying all
print(all_enemies_destroyed())  // true`;

        renderCodeBlock('test-commands', testCommands, 'lua');
    </script>

    <div class="success-box">
        <h3>State Checking Functions</h3>
        <p>You've implemented a fundamental pattern used for event triggering, UI updates, game flow control, achievements, quest completion, and wave systems—essential for responsive gameplay.</p>
    </div>
</div>

<style>
/* Disable copying for code blocks - students should type the code themselves */
.step-content .code-block-wrapper .copy-btn {
    display: none;
}

.step-content .code-block-wrapper .line-content {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.step-content .code-block-wrapper pre {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}
</style>
