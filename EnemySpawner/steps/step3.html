<div class="step-content">
    <h2>Step 3: Replace init_enemies()</h2>

    <p>Now that you have a working <code>spawn_enemy()</code> function, let's refactor <code>init_enemies()</code> to use it. This is a perfect example of how creating reusable functions pays offâ€”you'll replace dozens of lines of repetitive code with a single function call!</p>

    <div class="info-box">
        <h3>The Power of Abstraction</h3>
        <p>Right now, your <code>init_enemies()</code> function manually creates every enemy at game startâ€”setting positions, velocities, and properties for each one. This works, but it's repetitive and inflexible.</p>
        <p>By using <code>spawn_enemy()</code>, you get:</p>
        <ul>
            <li><strong>Less code</strong> - One function call instead of 5-10 lines per enemy</li>
            <li><strong>Consistency</strong> - All enemies use the same spawning logic</li>
            <li><strong>Flexibility</strong> - Easy to adjust how many enemies spawn at start</li>
        </ul>
    </div>

    <h3>Your Task</h3>

    <p>Refactor your <code>init_enemies()</code> function to use <code>spawn_enemy()</code> instead of manually creating enemies. For now, we'll start with just <strong>one enemy</strong> to keep things simple.</p>

    <h3>The Changes</h3>

    <p>Here's what the refactored code looks like. Notice how much simpler it becomes:</p>

    <div id="init-enemies-diff"></div>

    <script>
        const oldInit = `function init_enemies()
  enemies = {}

  -- LEFT EYE
  local left_eye = create_enemy("googlya", 28, 28)
  left_eye.x = 0
  left_eye.y = 0
  left_eye.vx = 0.7
  left_eye.vy = 0.57575
  left_eye.color = "#FF00FF"
  left_eye.rotation_speed = 12

  -- RIGHT EYE
  local right_eye = create_enemy("googlyb", 28, 28)
  right_eye.x = 0
  right_eye.y = 0
  right_eye.vx = -0.6
  right_eye.vy = 0.37575
  right_eye.color = "#00FFFF"
  right_eye.rotation_speed = -12

  -- FIRST ENEMY
  local enemy1 = create_enemy("enemy_ship", 32, 32)
  enemy1.x = 50
  enemy1.y = 50
  enemy1.vx = 0.5
  enemy1.vy = 0.3

  -- SECOND ENEMY
  local enemy2 = create_enemy("enemy_ship", 32, 32)
  enemy2.x = -50
  enemy2.y = -50
  enemy2.vx = -0.4
  enemy2.vy = -0.4
end`;

        const newInit = `function init_enemies()
  enemies = {}

  -- Spawn 1 enemy at the start
  spawn_enemy()
end`;

        renderDiffBlock('init-enemies-diff', oldInit, newInit, 'Refactor init_enemies() to use spawn_enemy()');
    </script>

    <div class="info-box">
        <h3>What Just Happened?</h3>
        <p>We went from <strong>33 lines of repetitive code</strong> down to <strong>5 lines</strong>. The enemy spawning logic is now centralized in <code>spawn_enemy()</code>, which means:</p>
        <ul>
            <li>If you want to change how enemies spawn, you only update one function</li>
            <li>To spawn more enemies at start, just call <code>spawn_enemy()</code> multiple times</li>
            <li>Your code is cleaner and easier to understand</li>
        </ul>
    </div>

    <h3>Testing Your Changes</h3>

    <p>After making this change, run your game. You should see:</p>
    <ul>
        <li><strong>One enemy</strong> spawning at the top of the screen</li>
        <li>The enemy moving downward with random horizontal drift</li>
        <li>All your existing functionality (player movement, lasers) still working</li>
    </ul>

    <div class="info-box">
        <h3>ðŸŽ® Try This!</h3>
        <p>Want more enemies at the start? Just call <code>spawn_enemy()</code> multiple times:</p>
        <pre><code>function init_enemies()
  enemies = {}

  -- Spawn 5 enemies at the start
  spawn_enemy()
  spawn_enemy()
  spawn_enemy()
  spawn_enemy()
  spawn_enemy()
end</code></pre>
        <p>This would have required <strong>165 lines of code</strong> with the old approach. Now it's just 5 function calls!</p>
    </div>

    <div class="success-box">
        <h3>Key Concept: Code Reuse</h3>
        <p>You've just experienced one of the most powerful principles in programming: <strong>Don't Repeat Yourself (DRY)</strong>.</p>
        <p>By creating a reusable <code>spawn_enemy()</code> function, you've made your code:</p>
        <ul>
            <li><strong>More maintainable</strong> - Changes happen in one place</li>
            <li><strong>More readable</strong> - The intent is clear from the function name</li>
            <li><strong>More flexible</strong> - Easy to spawn enemies anywhere in your code</li>
        </ul>
        <p>This same pattern applies to all programming: identify repetitive code, extract it into a function, and reuse it everywhere you need it.</p>
    </div>

    <p><strong>Next:</strong> In Step 4, you'll optimize <code>spawn_enemy()</code> with object poolingâ€”a professional technique used in real game engines to improve performance.</p>
</div>
